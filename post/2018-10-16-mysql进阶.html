<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="一个可以交流学习的网站"><title>mysql进阶 | caicai</title><link rel="stylesheet" type="text/css" href="//fonts.neworld.org/css?family=Source+Code+Pro"><link rel="stylesheet" type="text/css" href="/css/style.css?v=2.0.1"><link rel="stylesheet" type="text/css" href="/css/highlight.css?v=2.0.1"><link rel="Shortcut Icon" href="/favicon.ico"><link rel="bookmark" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">mysql进阶</h1><a id="logo" href="/.">caicai</a><p class="description">长路漫漫，唯py作伴。欢迎大家一起交流学习！</p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/atom.xml"><i class="fa fa-rss"> 订阅</i></a></div><div id="search-form"><div id="result-mask" class="hide"></div><label><input id="search-key" type="text" autocomplete="off" placeholder="Arama"></label><div id="result-wrap" class="hide"><div id="search-result"></div></div><div class="hide"><template id="search-tpl"><div class="item"><a href="/{path}" title="{title}"><div class="title">{title}</div><div class="time">{date}</div><div class="tags">{tags}</div></a></div></template></div></div></div><div id="layout" class="layout-g"><div class="layout-l"><div class="content_container"><div class="post"><h1 class="post-title">mysql进阶</h1><div class="post-meta"><a href="/post/2018-10-16-mysql进阶.html#comments" class="comment-count"></a><p><span class="date">Oct 16, 2018</span><span><a href="/categories/mysql/" class="category">mysql</a></span><span><i id="busuanzi_container_page_pv"><i id="busuanzi_value_page_pv"></i><i>点击</i></i></span></p></div><div class="post-content"><p>mysql的进阶知识，加油！</p>
<p>当心从删库到跑路 ？！！</p>
<a id="more"></a>
<h2 id="编码与约束"><a class="header-anchor" href="#编码与约束">-&gt; </a>编码与约束</h2>
<ul>
<li>
<p>设置编码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">-- utf8_bin 搜索时区分大小写</span><br><span class="line">-- utf8_bin_ci 搜索时不区分大小写</span><br><span class="line">create database SRS default charset utf8 collate utf8_bin;</span><br></pre></td></tr></table></figure>
<p>设置数据SRS的默认编码为utf8</p>
<p>collate utf8_bin; —&gt; mysql的字符序遵从命名惯例。以_ci(表示大小写不敏感)，以_cs(表示大小写敏感)，以_bin(表示用编码值进行比较</p>
</li>
<li>
<p>创建一个学院表</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">-- 创建学院表</span><br><span class="line">create table tb_college</span><br><span class="line">(</span><br><span class="line">collid int not null auto_increment comment &apos;学院编号&apos;,</span><br><span class="line">collname varchar(50) not null comment &apos;学院名称&apos;,</span><br><span class="line">collmaster varchar(20) not null comment &apos;院长姓名&apos;,</span><br><span class="line">collweb varchar(511) default &apos;&apos; comment &apos;学院网站&apos;,</span><br><span class="line">primary key (collid)</span><br><span class="line">);</span><br><span class="line">-- 创建教师表</span><br><span class="line">create table tb_teacher</span><br><span class="line">(</span><br><span class="line">teaid int not null comment &apos;教师工号&apos;,</span><br><span class="line">tname varchar(20) not null comment &apos;教师姓名&apos;,</span><br><span class="line">title varchar(10) default &apos;&apos; comment &apos;职称&apos;,</span><br><span class="line">collid int not null comment &apos;所属学院编号&apos;</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>添加唯一约束</p>
<p>代表该列值不能有重复</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">-- 添加唯一约束</span><br><span class="line">alter table tb_college add constraint uni_college_collname unique (collname);</span><br><span class="line"></span><br><span class="line">-- 删除唯一约束</span><br><span class="line">alter table tb_college drop index uni_college_collname</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>添加外键约束</p>
</li>
<li>
<p>外键分为</p>
<p>1 对 1：对任一表添加外键，并且还要添加唯一约束</p>
<p>1 对 多： 一般在多的表中添加外键</p>
<p>多 对 多 ：在关系型数据中，两张表不能表示两张表的关系，多对多时需要添加中间表进行外键约束</p>
</li>
<li>
<p>给教师表添加外键约束collid</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">-- 添加外键约束</span><br><span class="line">alter table tb_student add constraint fk_student_collid foreign key (collid) references tb_college (collid);</span><br><span class="line">-- 删除外键约束</span><br><span class="line">alter table tb_score drop foreign key fk_score_sid;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="e-r-实体关系图"><a class="header-anchor" href="#e-r-实体关系图">-&gt; </a>E-R(实体关系图)</h2>
<ul>
<li>
<p>外键/外键约束/ - 外来的主键 - 参照完整性</p>
</li>
<li>
<p>数据的完整性</p>
<ol>
<li>
<p>实体完整性：每一条记录都是独一无二的冗余</p>
<p>主键/唯一索引(唯一约束)</p>
</li>
<li>
<p>参照完整性：B表参照了A表，A表没有的记录在B表中绝不能出现<br>
出现</p>
<p>外键：给字表添加外键时要与父表的主键变量类型一致一致</p>
</li>
<li>
<p>域完整性：录入的数据都是有效的</p>
<p>数据类型/非空约束/默认值约束/检查约束（mysql不生效）</p>
</li>
</ol>
</li>
</ul>
<p><img src="/post/2018-10-16-mysql%E8%BF%9B%E9%98%B6%5Cshi.png" alt="shi"></p>
<h2 id="查询"><a class="header-anchor" href="#查询">-&gt; </a>查询</h2>
<ul>
<li>
<p>查询时sql语句的执行优先顺序</p>
<ol>
<li>FROM</li>
<li>WHERE</li>
<li>GROUP BY</li>
<li>HAVING</li>
<li>SELECT</li>
<li>DISTINCT</li>
<li>UNION</li>
<li>ORDER BY</li>
</ol>
</li>
<li>
<p>聚合函数</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">-- max() / min() / sum() / avg() / count()</span><br><span class="line">elect min(birth) from tb_student</span><br><span class="line">select max(birth) from tb_student</span><br><span class="line"></span><br><span class="line">-- 这些二函数经常与 group by 连用</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>连接查询法</p>
<p>查询时如果不添加筛选条件得到的结果会形成笛卡儿积</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">-- 查询学生姓名、所选课程名称和成绩(连接查询)</span><br><span class="line">-- 连接查询方法一</span><br><span class="line">select sname,cname,mark</span><br><span class="line">from tb_student,tb_course,tb_score</span><br><span class="line">where stuid=sid and couid=cid and mark is not null;</span><br><span class="line"></span><br><span class="line">-- 连接查询方法二</span><br><span class="line">select sname,cname,mark from tb_student</span><br><span class="line">inner join tb_score on stuid=sid</span><br><span class="line">inner join tb_course on couid=cid</span><br><span class="line">where mark is not null;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>group by 分组查询</p>
<p>安照 by 后面的列名进行分组查询</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">-- 查询选了两门以上的课程的学生姓名(子查询/分组条件/集合运算)</span><br><span class="line">-- () 改变优先级,先执行()里的语句</span><br><span class="line">select sname from tb_student where stuid in( </span><br><span class="line">select sid from tb_score group by sid having count(sid)&gt;2);</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>子查询</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">-- 子查询 - 在一个查询中又使用了另一个查询</span><br><span class="line">-- 查询年龄最大的学生的姓名(子查询+运算)</span><br><span class="line">select sname as 姓名,year(now())-year(birth) as 年龄 from tb_student where birth=(select min(birth) from tb_student)</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>子查询时，去重操作和集合运算效率是非常底下的</p>
<p>通常建议去用exists或not exists 操作来代替去重和集合运算</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">-- 去重和集合</span><br><span class="line">select ename as 主管,job from tbemp</span><br><span class="line">where eno in (select distinct mgr from tbemp where mgr is not null);</span><br><span class="line">-- exists 判断</span><br><span class="line">select ename,job from tbemp t1</span><br><span class="line">where exists (select &apos;x&apos; from tbemp t2 where t1.eno=t2.mgr);</span><br></pre></td></tr></table></figure>
<p>当后面where语句的条件为true时才会生成映射表x列，为false时映射表为空</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select &apos;x&apos; from tbemp t2,tbemp t1 where t1.ename=t2.mgr;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="视图"><a class="header-anchor" href="#视图">-&gt; </a>视图</h2>
<ul>
<li>
<p>视图是查询的快照</p>
<p>通过视图将用户表访问权限进一步加以限制，也就是说将来普通用户不能够直接查询表的数据，只能通过指定的视图查看到允许访问的内容。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">-- 创建视图 -- 得到一个（ename,dno,dname）列的数据表</span><br><span class="line">create view vw_emp_gt_avg as select ename,dno,dname from tbemp</span><br><span class="line"> -- 删除视图</span><br><span class="line">drop view 删除视图</span><br><span class="line">-- 这个语句是查询 vw_emp_gt_avg 表，</span><br><span class="line">select * from vw_emp_gt_avg;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="索引"><a class="header-anchor" href="#索引">-&gt; </a>索引</h2>
<ul>
<li>
<p>索引（相当于一本书的目录）</p>
<blockquote>
<p>为表创建索引可以加速查询（用空间换取时间）<br>
索引虽然好但是不能滥用，一方面索引会占用额外的存储空间<br>
另外索引会让增删改变得更慢，因为这些操作可能会导致更新索引<br>
如果哪个列经常用于查询的筛选条件，那么就应该在这个列上建立索引<br>
主键有默认的索引（唯一索引)</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">-- 创建索引</span><br><span class="line">-- 说明：如果使用模糊查询 如果查询条件不以%开头 那么索引有效</span><br><span class="line">-- 如果模糊查询的条件以%开头 那么索引失效（尽量避免）</span><br><span class="line">create index idx_emp_ename on tbemp (ename);</span><br><span class="line">create unique index nui_emp_ename on tbemp (ename);</span><br><span class="line"></span><br><span class="line">-- 删除索引</span><br><span class="line">alter table tbemp drop index nui_emp_ename</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="事务控制"><a class="header-anchor" href="#事务控制">-&gt; </a>事务控制</h2>
<ul>
<li>
<p>事务控制：要么全部成功执行，要么一个不执行</p>
</li>
<li>
<p>数据的一致性：事务</p>
</li>
<li>
<p>事务的ACID特性：</p>
<ol>
<li>Atomicity 原子性：不可分割</li>
<li>Consistency 一致性：事务前后数据状态一致</li>
<li>Isolation 隔离性：多个事务不能看到彼此的中间状态（未提交时别人看不到对表的改变）</li>
<li>Duration 持久性：事务完成后数据要持久化</li>
</ol>
</li>
<li>
<p>在出现并发事务访问数据的时候，数据库底层有锁机制来保护数据，但是通常我们在写SQL的时候不用显示的书写锁操作，数据库会根据我们设定的事务隔离级别自动的数据加锁。</p>
</li>
<li>
<p>并发数据访问可能出现的5中问题</p>
<ol>
<li>第一类丢失更新</li>
<li>第二类丢失更新</li>
<li>脏读  ： 隔离级别为Read Committed可以避免</li>
<li>不可重复读 - 一个事务在读取查询结果时发现其他事务更新了数据导致无法读取： 隔离级别为Repeatable Read可以避免</li>
<li>幻读 - 一个事务在执行查询时发现被其他事务提交了新的数据： 隔离级别为Serializable可以避免</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">begin</span><br><span class="line">-- start transaction; 开始事务</span><br><span class="line">update tb_score set mark=mark-2 where sid=1001 and mark is not null;</span><br><span class="line">update tb_score set mark=mark+2 where sid=1002 and mark is not null;</span><br><span class="line">-- 数据提交,只有提交后才生效</span><br><span class="line">commit;</span><br><span class="line">-- 事务回滚 - 未提交时可以回滚</span><br><span class="line">rollback;</span><br><span class="line"></span><br><span class="line">-- 四个级别</span><br><span class="line">-- Read Uncommitted</span><br><span class="line">-- Read Committed</span><br><span class="line">-- Repeatable Read</span><br><span class="line">-- Serializable</span><br><span class="line">select @@tx_isolation; -- 查看事务隔离级别</span><br><span class="line">session(当前会话)/global（全局）</span><br><span class="line">set session/global transaction isolation level read committed; -- 设置事务隔离级别</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="创建用户"><a class="header-anchor" href="#创建用户">-&gt; </a>创建用户</h2>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">-- 只能本机登录</span><br><span class="line">create user &apos;hellokitty&apos;@&apos;localhost&apos;</span><br><span class="line"></span><br><span class="line">-- 指定ip地址登录</span><br><span class="line">create user &apos;hellokitty&apos;@&apos;10.2.1.1&apos;</span><br><span class="line"></span><br><span class="line">-- 任意地址登录 并设置口令123123</span><br><span class="line">create user &apos;hellokitty&apos;@&apos;%&apos;identified by &apos;123123&apos;</span><br><span class="line"></span><br><span class="line">-- 授权  *.* 所有数据库的所有表</span><br><span class="line">grant select on srs.* to &apos;hellokitty&apos;@&apos;%&apos;;</span><br><span class="line">grant insert,delete,update on srs.* to &apos;hellokitty&apos;@&apos;%&apos;;</span><br><span class="line">grant create,drop,alter on srs.* to &apos;hellokitty&apos;@&apos;%&apos;;</span><br><span class="line"></span><br><span class="line">-- all privileges 所有权限</span><br><span class="line">-- with grant option 拥有将自己的权限授权给他人的权限</span><br><span class="line">grant all privileges on srs.* to &apos;hellokitty&apos;@&apos;%&apos; with grant option;</span><br><span class="line"></span><br><span class="line">-- 召回权限</span><br><span class="line">revoke all privileges on srs.* from &apos;hellokitty&apos;@&apos;%&apos;;</span><br></pre></td></tr></table></figure>
<h2 id="python控制mysql"><a class="header-anchor" href="#python控制mysql">-&gt; </a>python控制mysql</h2>
<ul>
<li>
<p>利用第三方模块pymysql</p>
<ol>
<li>
<p>charset：设置编码</p>
</li>
<li>
<p>autocommit：自动提交，不用自己写commit</p>
</li>
<li>
<p>query参数中的变量可以用占位符%s，args的参数会识别占位符并附对应的值</p>
<p>如果需要改变传值的顺序，可以用一个字典</p>
</li>
</ol>
<ul>
<li>更新表</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pymysql</span><br><span class="line"><span class="comment"># https://pypi.doubanio.com/simple 国内镜像</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="comment"># 1. 创建数据库连接</span></span><br><span class="line">    cur = pymysql.connect(host = <span class="string">"localhost"</span>, port = <span class="number">3306</span>,</span><br><span class="line">                        user = <span class="string">"root"</span>, password = <span class="string">"123456"</span>,</span><br><span class="line">                        db = <span class="string">"hrs"</span>, charset= <span class="string">"utf8"</span>,</span><br><span class="line">                         autocommit = <span class="keyword">True</span>)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">with</span> cur.cursor() <span class="keyword">as</span> cursor:</span><br><span class="line">            no = int(input(<span class="string">'部门编号：'</span>))</span><br><span class="line">            name = input(<span class="string">'部门名称：'</span>)</span><br><span class="line">            location = input(<span class="string">'部门所在地：'</span>)</span><br><span class="line">            <span class="comment"># query=update tbdept set dname=%s, dloc=%s where dno=%s</span></span><br><span class="line">            <span class="comment"># args=（no, name, location）</span></span><br><span class="line">            result = cursor.execute(</span><br><span class="line">                query=<span class="string">'update tbdept set dname=%(name)s,dloc=%(location)s where dno=%(no)s'</span>,</span><br><span class="line">                args=&#123;<span class="string">'no'</span>:no, <span class="string">'name'</span>: name, <span class="string">'location'</span>: location&#125;)</span><br><span class="line">            <span class="keyword">if</span> result == <span class="number">1</span>:</span><br><span class="line">                print(<span class="string">"操作成功"</span>)</span><br><span class="line">            <span class="comment"># cur.commit()</span></span><br><span class="line">    <span class="keyword">finally</span>:</span><br><span class="line">        cur.close()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>查询表</p>
<ol>
<li>cursorclass=pymysql.cursors.DictCursor ：游标查询默认返回元组，使用这个后返回一个以字典为元素的列表</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pymysql</span><br><span class="line"><span class="comment"># https://pypi.doubanio.com/simple 国内镜像</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Dept</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, no, name, location)</span>:</span></span><br><span class="line">        self.no = no</span><br><span class="line">        self.name = name</span><br><span class="line">        self.location = location</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="comment"># 1. 创建数据库连接</span></span><br><span class="line">    cur = pymysql.connect(host = <span class="string">"localhost"</span>, port = <span class="number">3306</span>,</span><br><span class="line">                        user = <span class="string">"root"</span>, password = <span class="string">"123456"</span>,</span><br><span class="line">                        db = <span class="string">"hrs"</span>, charset= <span class="string">"utf8"</span>,</span><br><span class="line">                        autocommit = <span class="keyword">True</span>, cursorclass=pymysql.cursors.DictCursor)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">with</span> cur.cursor() <span class="keyword">as</span> cursor:</span><br><span class="line">            <span class="comment"># update tbdept set dname=%s, dloc=%s where dno=%s</span></span><br><span class="line">            cursor.execute( <span class="string">"select dno as no, dname as name, dloc as location "</span></span><br><span class="line">                            <span class="string">"from tbdept"</span>)</span><br><span class="line">            <span class="comment"># print(cursor.fetchall()) 拿所有</span></span><br><span class="line">            print(cursor.fetchone()) <span class="comment"># 拿一个</span></span><br><span class="line">            print(cursor.fetchmany(<span class="number">2</span>)) <span class="comment"># 拿指定条数</span></span><br><span class="line">            print(<span class="string">'编号\t名称\t所在地'</span>)</span><br><span class="line">            <span class="keyword">for</span> row <span class="keyword">in</span> cursor.fetchall():</span><br><span class="line">                dept = Dept(**row)</span><br><span class="line">                <span class="comment"># **row ：解包 将一个自建解包为一个关键字参数传入类中</span></span><br><span class="line">                print(dept.no, end=<span class="string">'\t'</span>)</span><br><span class="line">                print(dept.name, end=<span class="string">'\t'</span>)</span><br><span class="line">                print(dept.location)</span><br><span class="line">                <span class="comment"># print(row['no'], end='\t')</span></span><br><span class="line">                <span class="comment"># print(row['name'], end='\t')</span></span><br><span class="line">                <span class="comment"># print(row['location'])</span></span><br><span class="line">            <span class="comment"># for row in cursor.fetchall():</span></span><br><span class="line">            <span class="comment">#     print(f'部门编号：&#123;row[0]&#125;')</span></span><br><span class="line">            <span class="comment">#     print(f'部门名称：&#123;row[1]&#125;')</span></span><br><span class="line">            <span class="comment">#     print(f'部门所在地：&#123;row[2]&#125;')</span></span><br><span class="line">            <span class="comment">#     print('-' * 20)</span></span><br><span class="line">            <span class="comment"># cur.commit()</span></span><br><span class="line">    <span class="keyword">finally</span>:</span><br><span class="line">        cur.close()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>
</li>
</ul>
</div><div class="tags"><a href="/tags/mysql进阶/">mysql进阶</a></div><div class="post-share"><div class="bdsharebuttonbox"><span style="float:left;line-height: 28px;height: 28px;font-size:16px;font-weight:blod">分享到：</span><a href="#" data-cmd="more" class="bds_more"></a><a href="#" data-cmd="mshare" title="分享到一键分享" class="bds_mshare"></a><a href="#" data-cmd="fbook" title="分享到Facebook" class="bds_fbook"></a><a href="#" data-cmd="twi" title="分享到Twitter" class="bds_twi"></a><a href="#" data-cmd="linkedin" title="分享到linkedin" class="bds_linkedin"></a><a href="#" data-cmd="youdao" title="分享到有道云笔记" class="bds_youdao"></a><a href="#" data-cmd="evernotecn" title="分享到印象笔记" class="bds_evernotecn"></a><a href="#" data-cmd="weixin" title="分享到微信" class="bds_weixin"></a><a href="#" data-cmd="qzone" title="分享到QQ空间" class="bds_qzone"></a><a href="#" data-cmd="tsina" title="分享到新浪微博" class="bds_tsina"></a></div></div><div class="post-nav"><a href="/post/2018-10-16-linux进阶.html" class="pre">linux进阶</a><a href="/post/2018-10-15-正则表达式.html" class="next">正则表达式</a></div><div id="comments"></div></div></div></div><div class="layout-r"><div id="sidebar"><div class="search-pla"></div><div id="toc" class="widget"><div class="widget-title"><i class="fa fa-fei">文章目录</i></div><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#编码与约束"><span class="toc-text">-&gt; 编码与约束</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#e-r-实体关系图"><span class="toc-text">-&gt; E-R(实体关系图)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#查询"><span class="toc-text">-&gt; 查询</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#视图"><span class="toc-text">-&gt; 视图</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#索引"><span class="toc-text">-&gt; 索引</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#事务控制"><span class="toc-text">-&gt; 事务控制</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#创建用户"><span class="toc-text">-&gt; 创建用户</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#python控制mysql"><span class="toc-text">-&gt; python控制mysql</span></a></li></ol></div><div class="widget"><div class="widget-title"><i class="fa fa-xie"> 最新文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/post/2018-10-20-知识点总结.html">知识点总结</a></li><li class="post-list-item"><a class="post-list-link" href="/post/2018-10-20-redis小结.html">redis小结</a></li><li class="post-list-item"><a class="post-list-link" href="/post/2018-10-16-linux进阶.html">linux进阶</a></li><li class="post-list-item"><a class="post-list-link" href="/post/2018-10-16-mysql进阶.html">mysql进阶</a></li><li class="post-list-item"><a class="post-list-link" href="/post/2018-10-15-正则表达式.html">正则表达式</a></li><li class="post-list-item"><a class="post-list-link" href="/post/2018-10-15-mysql小结.html">MYSQL小结</a></li><li class="post-list-item"><a class="post-list-link" href="/post/2018-10-13-约瑟夫环.html">约瑟夫环</a></li><li class="post-list-item"><a class="post-list-link" href="/post/2018-10-13-动态规划算法.html">动态规划算法</a></li><li class="post-list-item"><a class="post-list-link" href="/post/2018-10-13-汉诺塔问题.html">汉诺塔问题</a></li><li class="post-list-item"><a class="post-list-link" href="/post/2018-10-13-python抽象类.html">python抽象类，接口，归一化</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-gui"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/MYSQL/">MYSQL</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/linux/">linux</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/markdown/">markdown</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/mysql/">mysql</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/python/">python</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/sql/">sql</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/总结/">总结</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/正则表达式/">正则表达式</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/算法/">算法</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/算法题/">算法题</a><span class="category-list-count">1</span></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-biao"> 标签</i></div><div class="tagcloud"><a href="/tags/mysql进阶/" style="font-size: 15px;">mysql进阶</a> <a href="/tags/python抽象类/" style="font-size: 15px;">python抽象类</a> <a href="/tags/动态规划算法/" style="font-size: 15px;">动态规划算法</a> <a href="/tags/汉诺塔问题/" style="font-size: 15px;">汉诺塔问题</a> <a href="/tags/约瑟夫环/" style="font-size: 15px;">约瑟夫环</a> <a href="/tags/MYSQL/" style="font-size: 15px;">MYSQL</a> <a href="/tags/正则表达式/" style="font-size: 15px;">正则表达式</a> <a href="/tags/装饰器/" style="font-size: 15px;">装饰器</a> <a href="/tags/linux进阶/" style="font-size: 15px;">linux进阶</a> <a href="/tags/redis/" style="font-size: 15px;">redis</a> <a href="/tags/阅读/" style="font-size: 15px;">阅读</a> <a href="/tags/算法/" style="font-size: 15px;">算法</a> <a href="/tags/linux命令/" style="font-size: 15px;">linux命令</a> <a href="/tags/markdown语法/" style="font-size: 15px;">markdown语法</a> <a href="/tags/类/" style="font-size: 15px;">类</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-archive"> 归档</i></div><ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/10/">十月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/09/">九月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/08/">八月 2018</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-you"> 友情链接</i></div><ul></ul><a href="http://www.example1.com/" title="site-name1" target="_blank">site-name1</a></div></div></div></div><a id="totop" href="#top"></a><div id="footer"><div class="footer-info"><p><a href="/baidusitemap.xml">Baidu Site Haritası</a> |  <a href="/atom.xml">订阅</a> |  <a href="/about/">关于</a></p><p>本站总访问量：<i id="busuanzi_container_site_pv"><i id="busuanzi_value_site_pv"></i></i>次</p><p><span> Copyright &copy;<a href="/." rel="nofollow">菜菜.</a></span><span> Theme by<a rel="nofollow" target="_blank" href="https://github.com/chaooo/hexo-theme-BlueLake"> BlueLake.</a></span><span> Count by<a href="http://busuanzi.ibruce.info/"> busuanzi.</a></span><span> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a></span></p></div></div></div><script src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js" async></script><script type="text/javascript" src="/js/search.json.js?v=2.0.1"></script><script type="text/javascript" src="/js/toctotop.js?v=2.0.1" async></script><script>window._bd_share_config={"common":{"bdSnsKey":{},"bdText":"","bdMini":"2","bdMiniList":["mshare","weixin","tsina","qzone","linkedin","fbook","twi","print","renren","sqq","evernotecn","bdysc","tqq","tqf","bdxc","kaixin001","tieba","douban","bdhome","thx","ibaidu","meilishuo","mogujie","diandian","huaban","duitang","hx","fx","youdao","sdo","qingbiji","people","xinhua","mail","isohu","yaolan","wealink","ty","iguba","h163","copy"],"bdPic":"","bdStyle":"1","bdSize":"16"},"share":{},"image":{"viewList":["tsina","qzone","weixin","fbook","twi","linkedin","youdao","evernotecn","mshare"],"viewText":"分享到：","viewSize":"16"},"selectShare":{"bdContainerClass":null,"bdSelectMiniList":["tsina","qzone","weixin","fbook","twi","linkedin","youdao","evernotecn","mshare"]}};with(document)0[(getElementsByTagName('head')[0]||head).appendChild(createElement('script')).src='http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];
</script></body></html>